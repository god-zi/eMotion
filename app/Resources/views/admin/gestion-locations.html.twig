{% extends 'admin/layout.html.twig' %}

{% block body %}
<div class="container">
    <h1>Manager - Gestion des locations</h1>
    <table class="table">
        <tr class="entete">
            <td>Id résa</td>
            <td>Vehicule</td>
            <td>Client</td>
            <td>Date de début</td>
            <td>Date de fin</td>
            <td>Prix total</td>
            <td>État</td>
            <td>Actions</td>
        </tr>
        {% for resa in reservations %}
        <tr>
            <td>{{ resa.id }}</td>
            <td>{{ resa.vehicule }}</td>
            <td>{{ resa.user.prenom }} {{ resa.user.nom }}</td>
            <td>{{ resa.dateDebut|date('d-m-Y') }}</td>
            <td>{{ resa.dateFin|date('d-m-Y') }}</td>
            <td>{{ resa.prixTotal }}</td>
            <td>{{ resa.etat }}</td>
            <td class="actions">
                <a href="{{ path('admin_show_location', {'id': resa.id }) }}">
                    <span class="glyphicon glyphicon-search" aria-hidden="true"></span>
                </a>
                <a href="{{ path('admin_update_location', {'id': resa.id }) }}">
                    <span class="glyphicon glyphicon-edit" aria-hidden="true"></span>
                </a>
            </td>
        </tr>
        {% endfor %}
    </table>
    <a href="#" title="Ajouter location par date">Ajouter location par date</a> / <a href="#" title="Ajouter location par véhicule">Ajouter location par véhicule</a>
    <style>
        #admin-form-location{
            position: relative;
        }
    </style>
    <div id="admin-form-location">
        <div class="row">
        {{ form_start(form, {'attr': {'id': 'admin-location-form'}}) }}
         <input type="hidden" name="" class="daterangeSelect">
        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
            {{ form_errors(form) }}
        </div>
        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
            {{ form_row(form.user) }}
            {{ form_row(form.dateDebut) }}
            {{ form_row(form.dateFin) }}
        </div>
        {{ form_rest(form) }}
        {{ form_end(form) }}
        <div id="liste-offres">
        </div>
    </div>
</div>
{% endblock %}
{% block javascripts %}
<script>
    $( function() {

        var now = new Date();
        $('.daterangeSelect').daterangepicker({
            "autoApply": true,
            "cancelClass": "hide",
            "opens": "center",
            "minDate": now,
            "locale": {
                "format": "YYYY-MM-DD"
            },
            "parentEl": ".form-horizontal"
        });
        $('.daterangepicker').addClass('hide');

        $('#recherche_admin_dateDebut, #recherche_admin_dateFin').click(function() {
            $('.daterangepicker').removeClass('hide');
            $('.daterangeSelect').trigger('click');
        });

        $('.daterangeSelect').on('apply.daterangepicker', function(event, picker) {
            $('#recherche_admin_dateDebut').val(picker.startDate.format('DD/MM/YYYY'));
            $('#recherche_admin_dateFin').val(picker.endDate.format('DD/MM/YYYY'));
        });
        $('#recherche_admin_submit').on('click', function(e){
            e.preventDefault();
            $('#recherche_admin_idVehicule').val(0);
            var params = $('#admin-location-form').serialize();
            $.ajax({
                    type: "POST",
                    url: '{{ path('admin_locations_ajax') }}',
                    data: params,
                    success: function (retour) { 
                        $('#liste-offres').html(retour);
                    }
                });
        });

    } );
</script>
{% endblock %}

